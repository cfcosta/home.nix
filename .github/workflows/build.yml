name: "Build and cache"

on:
  push:

jobs:
  build-system:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: DeterminateSystems/nix-installer-action@v4
      - uses: cachix/cachix-action@v12
        with:
          name: cfcosta-home
          authToken: '${{ secrets.CACHIX_AUTH_TOKEN }}'
      - run: nix build .#nixosConfigurations.mothership.config.system.build.toplevel
  build-home:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: DeterminateSystems/nix-installer-action@v4
      - uses: cachix/cachix-action@v12
        with:
          name: cfcosta-home
          authToken: '${{ secrets.CACHIX_AUTH_TOKEN }}'
      - run: nix build .#profiles.x86_64-linux.mothership.home.activation-script
